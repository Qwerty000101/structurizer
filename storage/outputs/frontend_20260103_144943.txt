–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞: C:\Users\HAIER\Desktop\LLM\test\frontend

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
‚îî‚îÄ‚îÄ frontend
    ‚îú‚îÄ‚îÄ public
    ‚îÇ   ‚îî‚îÄ‚îÄ vite.svg
    ‚îú‚îÄ‚îÄ src
    ‚îÇ   ‚îú‚îÄ‚îÄ assets
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ react.svg
    ‚îÇ   ‚îú‚îÄ‚îÄ components
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfirmDialog.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfirmDialog.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CredentialManager.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CredentialManager.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CredentialModal.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CredentialModal.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customNodes.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FlowCanvas.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IOPanel.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IOPanel.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoadWorkflowModal.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoadWorkflowModal.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NodeInspector.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NodeSettingsModal.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NodeSettingsModal.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nodeTypes.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationModal.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationModal.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SaveWorkflowModal.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SaveWorkflowModal.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settingsPanel.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsPanel.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.css
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.jsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UniversalNode.jsx
    ‚îÇ   ‚îú‚îÄ‚îÄ contexts
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CredentialsContext.jsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModalContext.jsx
    ‚îÇ   ‚îú‚îÄ‚îÄ hooks
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useFlow.jsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useFlowState.jsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useNotification.jsx
    ‚îÇ   ‚îú‚îÄ‚îÄ services
    ‚îÇ   ‚îú‚îÄ‚îÄ stores
    ‚îÇ   ‚îú‚îÄ‚îÄ App.css
    ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx
    ‚îÇ   ‚îú‚îÄ‚îÄ index.css
    ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx
    ‚îú‚îÄ‚îÄ eslint.config.js
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ package-lock.json
    ‚îú‚îÄ‚îÄ package.json
    ‚îú‚îÄ‚îÄ README.md
    ‚îî‚îÄ‚îÄ vite.config.js

–¢–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞:

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\eslint.config.js:
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\vite.config.js:
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})


–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\App.jsx:
// frontend/src/App.jsx - –¥–æ–±–∞–≤—å—Ç–µ CredentialManager
import FlowCanvas from "./components/FlowCanvas";
import Sidebar from "./components/Sidebar";
import NodeSettingsModal from "./components/NodeSettingsModal";
import CredentialModal from "./components/CredentialModal";
import CredentialManager from "./components/CredentialManager";
import SaveWorkflowModal from "./components/SaveWorkflowModal";
import LoadWorkflowModal from "./components/LoadWorkflowModal";
import "./App.css";
import { useModal } from "./contexts/ModalContext";

export default function App() {
  const { modals, modalProps, closeModal } = useModal();

  return (
    <div className="app-layout">
      <Sidebar />
      <div className="main-content">
        <FlowCanvas />
      </div>
      
      {/* Node Settings Modal */}
      {modals.nodeSettings && (
        <NodeSettingsModal
          isOpen={modals.nodeSettings}
          onClose={() => closeModal("nodeSettings")}
          nodeId={modalProps.nodeSettings?.nodeId}
        />
      )}
      
      {/* Credential Modal (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è) */}
      {modals.credential && (
        <CredentialModal
          isOpen={modals.credential}
          onClose={() => closeModal("credential")}
          {...modalProps.credential}
        />
      )}
      
      {/* Credential Manager Modal (–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–æ–µ –æ–∫–Ω–æ) */}
      {modals.credentialManager && (
        <CredentialManager
          isOpen={modals.credentialManager}
          onClose={() => closeModal("credentialManager")}
          {...modalProps.credentialManager}
        />
      )}
      
      {/* Save Workflow Modal */}
      {modals.saveWorkflow && (
        <SaveWorkflowModal
          isOpen={modals.saveWorkflow}
          onClose={() => closeModal("saveWorkflow")}
          {...modalProps.saveWorkflow}
        />
      )}
      
      {/* Load Workflow Modal */}
      {modals.loadWorkflow && (
        <LoadWorkflowModal
          isOpen={modals.loadWorkflow}
          onClose={() => closeModal("loadWorkflow")}
          {...modalProps.loadWorkflow}
        />
      )}
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\main.jsx:
// main.jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'
import { FlowProvider } from './hooks/useFlow.jsx'
import { NotificationProvider } from './hooks/useNotification.jsx'
import { ReactFlowProvider } from 'reactflow'
import { CredentialsProvider } from './contexts/CredentialsContext'
import { ModalProvider } from './contexts/ModalContext' // –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∏–º–ø–æ—Ä—Ç

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <NotificationProvider> {/* –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–¥–µ—Å—å */}
      <ReactFlowProvider>
        <FlowProvider>
          <CredentialsProvider>
            <ModalProvider>
              <App />
            </ModalProvider>
          </CredentialsProvider>
        </FlowProvider>
      </ReactFlowProvider>
    </NotificationProvider>
  </StrictMode>,
)

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\ConfirmDialog.jsx:
// frontend/src/components/ConfirmDialog.jsx
import "./ConfirmDialog.css";

export default function ConfirmDialog({
  isOpen,
  onClose,
  title,
  message,
  onConfirm,
  onCancel,
  confirmText = "–î–∞",
  cancelText = "–ù–µ—Ç"
}) {
  if (!isOpen) return null;

  const handleBackgroundClick = (e) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  const handleConfirm = () => {
    onConfirm();
    onClose();
  };

  const handleCancel = () => {
    if (onCancel) onCancel();
    onClose();
  };

  return (
    <div className="confirm-dialog-backdrop" onClick={handleBackgroundClick}>
      <div className="confirm-dialog" onClick={(e) => e.stopPropagation()}>
        <div className="confirm-dialog-header">
          <h3>{title}</h3>
          <button className="confirm-dialog-close" onClick={handleCancel}>
            ‚úï
          </button>
        </div>
        
        <div className="confirm-dialog-body">
          <p>{message}</p>
        </div>
        
        <div className="confirm-dialog-footer">
          <button 
            className="confirm-dialog-btn cancel" 
            onClick={handleCancel}
          >
            {cancelText}
          </button>
          <button 
            className="confirm-dialog-btn confirm" 
            onClick={handleConfirm}
            autoFocus
          >
            {confirmText}
          </button>
        </div>
      </div>
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\CredentialManager.jsx:
// frontend/src/components/CredentialManager.jsx
import { useState, useEffect, useRef } from "react";
import axios from "axios";
import "./CredentialManager.css";
import { useNotification } from "../hooks/useNotification";
import { useModal } from "../contexts/ModalContext";
import ConfirmDialog from "./ConfirmDialog";

export default function CredentialManager({
  isOpen,
  onClose,
  credentialTypes: propCredentialTypes = [],
  onCredentialCreated,
  onCredentialDeleted
}) {
  const [credentials, setCredentials] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const { openModal, closeModal } = useModal(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º closeModal —Ç–æ–∂–µ
  const [credentialToDelete, setCredentialToDelete] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [credentialTypes, setCredentialTypes] = useState(propCredentialTypes);
  
  const modalRef = useRef(null);
  
  const { showError, showSuccess } = useNotification();

  useEffect(() => {
    if (isOpen) {
      loadData();
    }
  }, [isOpen]);

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  useEffect(() => {
    const handleClickOutside = (event) => {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π CredentialModal
      const credentialModal = document.querySelector('.cred-modal-backdrop');
      if (credentialModal) {
        return; // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º CredentialManager –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç CredentialModal
      }
      
      if (modalRef.current && !modalRef.current.contains(event.target)) {
        if (!showDeleteConfirm) {
          onClose();
        }
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen, onClose, showDeleteConfirm]);

  const loadData = async () => {
    setLoading(true);
    setError(null);
    try {
      const credsResponse = await axios.get("http://localhost:3001/api/credentials");
      setCredentials(credsResponse.data);
      
      if (propCredentialTypes.length === 0) {
        const typesResponse = await axios.get("http://localhost:3001/api/credential-types");
        setCredentialTypes(typesResponse.data);
      }
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err);
      const errorMsg = err.response?.data?.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å credentials";
      setError(errorMsg);
      showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏", errorMsg);
    } finally {
      setLoading(false);
    }
  };

  const handleDeleteClick = (credential, event) => {
    event.stopPropagation();
    setCredentialToDelete(credential);
    setShowDeleteConfirm(true);
  };

  const handleDeleteConfirm = async () => {
    if (!credentialToDelete) return;
    
    try {
      const response = await axios.delete(`http://localhost:3001/api/credentials/${credentialToDelete.id}`);
      
      if (response.data.success) {
        setCredentials(credentials.filter(c => c.id !== credentialToDelete.id));
        
        showSuccess("–£–¥–∞–ª–µ–Ω–æ", `Credentials "${credentialToDelete.name}" —É–¥–∞–ª–µ–Ω—ã`, {
          autoClose: true,
          autoCloseDelay: 3000
        });
        
        if (onCredentialDeleted) {
          onCredentialDeleted(credentialToDelete.id);
        }
      } else {
        throw new Error(response.data.error || "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å credentials");
      }
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", err);
      const errorMsg = err.response?.data?.error || err.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å credentials";
      showError("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è", errorMsg);
    } finally {
      setShowDeleteConfirm(false);
      setCredentialToDelete(null);
    }
  };

  const handleCreateNew = () => {
    openModal("credential", {
      credentialTypes: credentialTypes,
      onSuccess: (createdCredential) => {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
        setCredentials(prev => [...prev, createdCredential]);
        // showSuccess("–°–æ–∑–¥–∞–Ω–æ", `Credentials "${createdCredential.name}" —Å–æ–∑–¥–∞–Ω—ã`, {
        //   autoClose: true,
        //   autoCloseDelay: 3000
        // });
        
        if (onCredentialCreated) {
          onCredentialCreated(createdCredential);
        }
      },
      mode: "create"
    });
  };

  const formatDate = (dateString) => {
    if (!dateString) return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
    try {
      const date = new Date(dateString);
      return date.toLocaleString("ru-RU");
    } catch {
      return "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞";
    }
  };

  if (!isOpen) return null;

  return (
    <>
      <div className="load-modal-backdrop">
        <div 
          ref={modalRef}
          className="load-modal" 
          onClick={(e) => e.stopPropagation()}
        >
          <div className="modal-header">
            <h2>üîê –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <button 
              className="refresh-btn" 
              onClick={loadData}
              title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫"
              disabled={loading}
            >
              ‚ü≥
            </button>
          </div>

          {loading ? (
            <div className="loading-state">
              <div className="spinner"></div>
              <p>–ó–∞–≥—Ä—É–∑–∫–∞ credentials...</p>
            </div>
          ) : error ? (
            <div className="error-state">
              <p>‚ùå {error}</p>
              <button 
                onClick={loadData}
                className="retry-btn"
              >
                –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
              </button>
            </div>
          ) : credentials.length === 0 ? (
            <div className="empty-state">
              <p>üì≠ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö credentials</p>
              <p className="hint">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π credentials –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
            </div>
          ) : (
            <div className="workflows-list">
              {credentials.map((cred) => {
                const credType = credentialTypes.find(t => t.name === cred.type);
                return (
                  <div 
                    key={cred.id}
                    className="workflow-item"
                    title={`ID: ${cred.id}\n–°–æ–∑–¥–∞–Ω: ${formatDate(cred.createdAt)}`}
                  >
                    <div className="workflow-info">
                      <div className="workflow-name">{cred.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}</div>
                      <div className="workflow-meta">
                        <span className="workflow-id">ID: {cred.id}</span>
                        <span className="workflow-stats">
                          üìÅ –¢–∏–ø: {credType?.displayName || cred.type}
                        </span>
                        <span className="workflow-date">
                          üìÖ {formatDate(cred.createdAt)}
                        </span>
                      </div>
                    </div>
                    <div className="workflow-actions">
                      <button 
                        className="delete-btn"
                        onClick={(e) => handleDeleteClick(cred, e)}
                        title="–£–¥–∞–ª–∏—Ç—å credential"
                      >
                        üóëÔ∏è
                      </button>
                    </div>
                  </div>
                );
              })}
            </div>
          )}

          <div className="modal-footer">
            <button 
              className="btn cancel" 
              onClick={onClose}
              disabled={loading}
            >
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
            <button 
              className="btn load" 
              onClick={handleCreateNew}
              disabled={loading}
            >
              –°–æ–∑–¥–∞—Ç—å
            </button>
          </div>
        </div>
      </div>

      {/* –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è */}
      <ConfirmDialog
        isOpen={showDeleteConfirm}
        onClose={() => {
          setShowDeleteConfirm(false);
          setCredentialToDelete(null);
        }}
        title="–£–¥–∞–ª–∏—Ç—å Credential"
        message={`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${credentialToDelete?.name || '—ç—Ç–æ—Ç credential'}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`}
        onConfirm={handleDeleteConfirm}
        onCancel={() => {
          setShowDeleteConfirm(false);
          setCredentialToDelete(null);
        }}
        confirmText="–£–¥–∞–ª–∏—Ç—å"
        cancelText="–û—Ç–º–µ–Ω–∞"
      />
    </>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\CredentialModal.jsx:
// frontend/src/components/CredentialModal.jsx
import { useState, useEffect } from "react";
import "./CredentialModal.css";
import { useNotification } from "../hooks/useNotification";
import { useCredentials } from "../contexts/CredentialsContext";

export default function CredentialModal({
  isOpen,
  onClose,
  credentialTypes: propCredentialTypes = [],
  onCreate,
  mode = "create",
  credentialType,
  onSuccess,
  onSelect,
}) {
  const [type, setType] = useState("");
  const [name, setName] = useState("");
  const [formData, setFormData] = useState({});
  const { showError, showSuccess } = useNotification();
  const { 
    credentialTypes: contextCredentialTypes, 
    createCredential: createCredentialFromContext,
  } = useCredentials();
  
  const credentialTypes = propCredentialTypes.length > 0 ? propCredentialTypes : contextCredentialTypes;

  useEffect(() => {
    if (isOpen) {
      let initialType = "";
      
      if (credentialType && credentialTypes.some(ct => ct.name === credentialType)) {
        initialType = credentialType;
      } else if (credentialTypes.length > 0) {
        initialType = credentialTypes[0].name;
      }
      
      setType(initialType);
      setName("");
      setFormData({});
    }
  }, [isOpen, credentialType, credentialTypes]);

  if (!isOpen) return null;

  const selectedType = credentialTypes.find((t) => t.name === type) || credentialTypes[0];

  const handleChange = (field, value) => {
    setFormData((prev) => ({ ...prev, [field]: value }));
  };

  const handleSave = async () => {
    if (!name || !type) {
      showError("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–∏–ø credentials");
      return;
    }
    
    try {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –ø—Ä–æ–ø—Å–æ–≤ –∏–ª–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      const createFn = onCreate || createCredentialFromContext;
      if (!createFn) {
        throw new Error("No create function available");
      }
      
      const createdCredential = await createFn(name, type, formData);
      
      // –£–°–ü–ï–®–ù–û–ï –°–û–ó–î–ê–ù–ò–ï - —Å–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      onClose();
      
      // –ó–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ –≤—ã–∑—ã–≤–∞–µ–º onSuccess
      showSuccess("Credentials —Å–æ–∑–¥–∞–Ω—ã", `"${name}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã`, {
        autoClose: true,
        autoCloseDelay: 3000
      });
      
      // –í—ã–∑—ã–≤–∞–µ–º –∫–æ–ª–ª–±—ç–∫ —É—Å–ø–µ—Ö–∞
      if (onSuccess) {
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã–ª–æ—Å—å
        setTimeout(() => {
          onSuccess(createdCredential);
        }, 100);
      }
      
      // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è onSelect
      if (onSelect && mode === "create") {
        onSelect(createdCredential.id);
      }
      
    } catch (error) {
      showError("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è", error.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å credentials");
    }
  };

  return (
    <div className="cred-modal-backdrop" onClick={onClose}>
      <div className="cred-modal" onClick={(e) => e.stopPropagation()}>
        <h2>–°–æ–∑–¥–∞—Ç—å Credentials</h2>

        {/* Name */}
        <div className="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input
            value={name}
            onChange={(e) => setName(e.target.value)}
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏"
            onKeyDown={(e) => {
              if (e.key === 'Enter') handleSave();
              if (e.key === 'Escape') onClose();
            }}
            autoFocus
          />
        </div>

        {/* –¢–∏–ø */}
        {(!credentialType || credentialTypes.length > 1) && (
          <div className="form-group">
            <label>–¢–∏–ø Credentials</label>
            <select 
              value={type} 
              onChange={(e) => setType(e.target.value)}
              disabled={credentialType && credentialTypes.length === 1}
            >
              <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
              {credentialTypes.map((ct) => (
                <option key={ct.name} value={ct.name}>
                  {ct.displayName || ct.name}
                </option>
              ))}
            </select>
          </div>
        )}

        {/* –ü–æ–ª—è —Ç–∏–ø–∞ */}
        {selectedType && selectedType.properties && (
          <>
            <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
            {selectedType.properties.map((p) => (
              <div key={p.name} className="form-group">
                <label>{p.displayName || p.name}</label>

                {p.type === "string" || p.type === "password" ? (
                  <input
                    type={p.type === "password" ? "password" : "text"}
                    value={formData[p.name] || ""}
                    onChange={(e) => handleChange(p.name, e.target.value)}
                    placeholder={p.placeholder}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter') handleSave();
                    }}
                  />
                ) : (
                  <input
                    type="text"
                    value={formData[p.name] || ""}
                    onChange={(e) => handleChange(p.name, e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter') handleSave();
                    }}
                  />
                )}
              </div>
            ))}
          </>
        )}

        <div className="cred-modal-footer">
          <button className="btn cancel" onClick={onClose}>
            –û—Ç–º–µ–Ω–∞
          </button>
          <button className="btn save" onClick={handleSave}>
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\FlowCanvas.jsx:
// frontend/src/components/FlowCanvas.jsx
import ReactFlow, {
  Background,
  Controls,
  MiniMap,
} from "reactflow";
import "reactflow/dist/style.css";
import { useFlow } from "../hooks/useFlow";
import { useModal } from "../contexts/ModalContext"; // –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –∏–º–ø–æ—Ä—Ç

export default function FlowCanvas() {
  const {
    nodes,
    edges,
    onNodesChange,
    onEdgesChange,
    onConnect,
    nodeTypes,
  } = useFlow();
  
  const { openModal } = useModal(); // –ü–æ–ª—É—á–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–æ–∫

  // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞
  const handleNodeDoubleClick = (event, node) => {
    openModal("nodeSettings", { nodeId: node.id });
  };

  return (
    <ReactFlow
      nodes={nodes}
      edges={edges}
      onNodesChange={onNodesChange}
      onEdgesChange={onEdgesChange}
      onConnect={onConnect}
      nodeTypes={nodeTypes}
      onNodeDoubleClick={handleNodeDoubleClick} // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
      fitView
      connectionLineStyle={{ stroke: "#fff", strokeWidth: 2 }}
      deleteKeyCode={["Delete", "Backspace"]}
      multiSelectionKeyCode={["Shift"]}
      selectionKeyCode={["Ctrl"]}
      style={{ background: "#0a0a0a" }}
    >
      <Background color="#334155" gap={16} />
      <MiniMap
        nodeStrokeColor={() => "#1e3a8a"}
        nodeColor={() => '#1e3a8a'}
        nodeBorderRadius={3}
        zoomable
        pannable
      />
      <Controls />
    </ReactFlow>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\IOPanel.jsx:
// frontend/src/components/IOPanel.jsx
import React from "react";
import "./IOPanel.css"; // –°–æ–∑–¥–∞–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –¥–ª—è —Å—Ç–∏–ª–µ–π

export default function IOPanel({ title, data, mode = "json" }) {
  console.log(`üì¶ IOPanel "${title}":`, data);
  if (!data || (Array.isArray(data) && data.length === 0)) {
    return (
      <div className="io-panel empty">
        <div className="io-title">{title}</div>
        <div className="io-empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
      </div>
    );
  }

  const renderContent = () => {
    // –ï—Å–ª–∏ —ç—Ç–æ –º–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∫–∞–∫ –≤ n8n)
    if (Array.isArray(data)) {
      return data.map((item, index) => {
        const json = item?.json || item;
        return (
          <div key={index} className="io-item">
            <div className="io-item-header">
              <span className="io-item-index">–≠–ª–µ–º–µ–Ω—Ç #{index + 1}</span>
              {/* {item?.meta?.preview && (
                <span className="io-item-preview">{item.meta.preview}</span>
              )} */}
            </div>
            <pre className="io-item-content">
              {JSON.stringify(json, null, 2)}
            </pre>
          </div>
        );
      });
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç (–¥–ª—è raw –¥–∞–Ω–Ω—ã—Ö)
    return <pre>{JSON.stringify(data, null, 2)}</pre>;
  };

  return (
    <div className="io-panel">
      <div className="io-header">
        <div className="io-title">{title}</div>
        <div className="io-count">
          {Array.isArray(data) ? `${data.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤` : '–û–±—ä–µ–∫—Ç'}
        </div>
      </div>
      <div className="io-content">
        {renderContent()}
      </div>
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\LoadWorkflowModal.jsx:
import { useState, useEffect } from "react";
import "./LoadWorkflowModal.css";
import axios from "axios";
import { useNotification } from "../hooks/useNotification";
import ConfirmDialog from "./ConfirmDialog"; // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

export default function LoadWorkflowModal({
  isOpen,
  onClose,
  onLoad
}) {
  const [workflows, setWorkflows] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [selectedId, setSelectedId] = useState("");
  const [showConfirmDialog, setShowConfirmDialog] = useState(false);
  const [workflowToDelete, setWorkflowToDelete] = useState(null);
  
  const { showError, showSuccess } = useNotification();

  useEffect(() => {
    if (isOpen) {
      loadWorkflows();
    }
  }, [isOpen]);

  const loadWorkflows = async () => {
    setLoading(true);
    setError(null);
    try {
      const response = await axios.get("http://localhost:3001/api/workflow/list");
      setWorkflows(response.data);
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ö–µ–º:", err);
      const errorMsg = err.response?.data?.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ö–µ–º";
      setError(errorMsg);
      showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏", errorMsg);
    } finally {
      setLoading(false);
    }
  };

  const handleLoad = () => {
    if (!selectedId) {
      showError("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ö–µ–º—É", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ö–µ–º—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏");
      return;
    }
    onLoad(selectedId);
    onClose();
  };

  const handleDeleteClick = (id, event) => {
    event.stopPropagation();
    const workflowToDelete = workflows.find(w => w.id === id);
    setWorkflowToDelete({
      id,
      name: workflowToDelete?.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
    });
    setShowConfirmDialog(true);
  };

  const handleDeleteConfirm = async () => {
    if (!workflowToDelete) return;
    
    try {
      await axios.delete(`http://localhost:3001/api/workflow/${workflowToDelete.id}`);
      // –£–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞
      setWorkflows(workflows.filter(w => w.id !== workflowToDelete.id));
      if (selectedId === workflowToDelete.id) {
        setSelectedId("");
      }
      showSuccess("–°—Ö–µ–º–∞ —É–¥–∞–ª–µ–Ω–∞", `–°—Ö–µ–º–∞ "${workflowToDelete.name}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞`, {
        autoClose: true,
        autoCloseDelay: 3000
      });
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã:", err);
      const errorMsg = err.response?.data?.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å—Ö–µ–º—É";
      showError("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è", errorMsg);
    } finally {
      setShowConfirmDialog(false);
      setWorkflowToDelete(null);
    }
  };

  const formatDate = (dateString) => {
    if (!dateString) return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
    try {
      const date = new Date(dateString);
      return date.toLocaleString("ru-RU");
    } catch (err) {
      return "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞";
    }
  };

  if (!isOpen) return null;

  return (
    <>
      <div className="load-modal-backdrop">
        <div className="load-modal">
          <div className="modal-header">
            <h2>üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É</h2>
            <button 
              className="refresh-btn" 
              onClick={loadWorkflows}
              title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫"
              disabled={loading}
            >
              ‚ü≥
            </button>
          </div>

          {loading ? (
            <div className="loading-state">
              <div className="spinner"></div>
              <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ö–µ–º...</p>
            </div>
          ) : error ? (
            <div className="error-state">
              <p>‚ùå {error}</p>
              <button 
                onClick={loadWorkflows}
                className="retry-btn"
              >
                –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
              </button>
            </div>
          ) : workflows.length === 0 ? (
            <div className="empty-state">
              <p>üì≠ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å—Ö–µ–º</p>
              <p className="hint">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Ö–µ–º—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–µ</p>
            </div>
          ) : (
            <div className="workflows-list">
              {workflows.map((workflow) => (
                <div 
                  key={workflow.id}
                  className={`workflow-item ${selectedId === workflow.id ? 'selected' : ''}`}
                  onClick={() => setSelectedId(workflow.id)}
                  onDoubleClick={() => {
                    setSelectedId(workflow.id);
                    handleLoad();
                  }}
                  title="–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞, –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏"
                >
                  <div className="workflow-info">
                    <div className="workflow-name">{workflow.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}</div>
                    <div className="workflow-meta">
                      <span className="workflow-id">ID: {workflow.id}</span>
                      <span className="workflow-stats">
                        üß© {workflow.nodesCount || 0} –Ω–æ–¥ ‚Ä¢ üîó {workflow.edgesCount || 0} —Å–≤—è–∑–µ–π
                      </span>
                      <span className="workflow-date">
                        üìÖ {formatDate(workflow.savedAt)}
                      </span>
                    </div>
                  </div>
                  <div className="workflow-actions">
                    <button 
                      className="delete-btn"
                      onClick={(e) => handleDeleteClick(workflow.id, e)}
                      title="–£–¥–∞–ª–∏—Ç—å —Å—Ö–µ–º—É"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}

          <div className="modal-footer">
            <button 
              className="btn cancel" 
              onClick={onClose}
              disabled={loading}
            >
              –û—Ç–º–µ–Ω–∞
            </button>
            <button 
              className="btn load" 
              onClick={handleLoad}
              disabled={loading || !selectedId}
            >
              –ó–∞–≥—Ä—É–∑–∏—Ç—å
            </button>
          </div>
        </div>
      </div>

      {/* –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è */}
      <ConfirmDialog
        isOpen={showConfirmDialog}
        onClose={() => {
          setShowConfirmDialog(false);
          setWorkflowToDelete(null);
        }}
        title="–£–¥–∞–ª–∏—Ç—å —Å—Ö–µ–º—É"
        message={`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ö–µ–º—É "${workflowToDelete?.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}"?`}
        onConfirm={handleDeleteConfirm}
        onCancel={() => {
          setShowConfirmDialog(false);
          setWorkflowToDelete(null);
        }}
        confirmText="–£–¥–∞–ª–∏—Ç—å"
        cancelText="–û—Ç–º–µ–Ω–∞"
      />
    </>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\NodeInspector.jsx:
// src/components/NodeInspector.jsx

import React, { useState } from "react";
import IOPanel from "./IOPanel";

export default function NodeInspector({ selectedNode, updateNodeData }) {

  const [activeTab, setActiveTab] = useState("output");

  if (!selectedNode) {
    return (
      <div className="node-inspector empty">
        –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–¥—É
      </div>
    );
  }

  const nodeData = selectedNode.data || {};
  const runData = nodeData.runData || {};

  return (
    <div className="node-inspector-wrapper">

      {/* INPUT (–°–õ–ï–í–ê) */}
      <div className="node-panel left">
        <IOPanel
          title="Input"
          data={runData.input}
        />
      </div>

      {/* SETUP (–¶–ï–ù–¢–†) */}
      <div className="node-panel center">

        <h2>{nodeData.label}</h2>

        {/* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ–¥—ã */}
        {Object.entries(nodeData).map(([key, value]) => {
          if (key === "label" || key === "runData") return null;

          return (
            <div key={key} className="node-param">
              <label>{key}</label>
              <input
                value={value}
                onChange={e =>
                  updateNodeData(selectedNode.id, {
                    [key]: e.target.value
                  })
                }
              />
            </div>
          );
        })}
      </div>

      {/* OUTPUT (–°–ü–†–ê–í–ê) */}
      <div className="node-panel right">

        <div className="tabs">
          {["output", "raw", "error"].map(tab => (
            <button
              key={tab}
              className={activeTab === tab ? "active" : ""}
              onClick={() => setActiveTab(tab)}
            >
              {tab.toUpperCase()}
            </button>
          ))}
        </div>

        {activeTab === "output" && (
          <IOPanel
            title="Output"
            data={runData.output}
          />
        )}

        {activeTab === "raw" && (
          <IOPanel
            title="Raw"
            data={runData}
          />
        )}

        {activeTab === "error" && (
          <IOPanel
            title="Error"
            data={runData?.error}
          />
        )}

      </div>
    </div>
  );
}


–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\NodeSettingsModal.jsx:
// frontend/src/components/NodeSettingsModal.jsx
import { useEffect, useState, useMemo, useCallback } from "react";
import { useFlow } from "../hooks/useFlow";
import IOPanel from "./IOPanel";
import { useCredentials } from "../contexts/CredentialsContext"; // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç
import { useModal } from "../contexts/ModalContext";
import "./NodeSettingsModal.css";

export default function NodeSettingsModal({ 
  isOpen, 
  onClose, 
  nodeId 
}) {
  const { nodes, updateNodeData, availableNodes } = useFlow();
  const { credentials, credentialTypes } = useCredentials(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
  const { openModal } = useModal();

  const [selectedNode, setSelectedNode] = useState(null);
  const [nodeDefinition, setNodeDefinition] = useState(null);
  const [activeTab, setActiveTab] = useState("output");
  const [runData, setRunData] = useState({ input: [], output: [] });

  
  // –ù–∞—Ö–æ–¥–∏–º –Ω–æ–¥—É –ø–æ ID
  useEffect(() => {
  if (nodeId) {
    const node = nodes.find((n) => n.id === nodeId);
    setSelectedNode(node);
    
    // –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ runData
    const nodeRunData = node?.data?.runData || { input: [], output: [] };
    console.log(`üìä RunData –¥–ª—è –Ω–æ–¥—ã ${nodeId}:`, nodeRunData);
    setRunData(nodeRunData);
    
    const def = availableNodes.find((n) => n.name === node?.type);
    setNodeDefinition(def || null);
  }
}, [nodeId, nodes, availableNodes]);

  // –û–±–Ω–æ–≤–ª—è–µ–º runData –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–æ–¥—ã
  useEffect(() => {
    if (nodeId) {
      const node = nodes.find((n) => n.id === nodeId);
      setRunData(node?.data?.runData || {});
    }
  }, [nodes, nodeId]);

  const handleDataChange = (propertyName, value) => {
    if (nodeId) {
      updateNodeData(nodeId, { [propertyName]: value });
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ credentials
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ credentials
const handleOpenCredentialModal = (propertyName, credentialType) => {
  openModal("credential", {
    mode: "create", // –∏–ª–∏ "select" –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
    credentialType: credentialType,
    
    // –î–ª—è —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    onCreateSuccess: (createdCredential) => {
      if (createdCredential && createdCredential.id && nodeId) {
        updateNodeData(nodeId, { [propertyName]: createdCredential.id });
        console.log(`Created and selected: ${createdCredential.name}`);
      }
    },
    
    // –î–ª—è —Ä–µ–∂–∏–º–∞ –≤—ã–±–æ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    onSelect: (credId) => {
      if (credId && nodeId) {
        updateNodeData(nodeId, { [propertyName]: credId });
        console.log(`Selected existing credential: ${credId}`);
      }
    }
  });
};

  // –ü–æ–ª—É—á–∞–µ–º credentials –ø–æ —Ç–∏–ø—É
  const getCredentialsByType = useMemo(() => {
    return (credentialType) => {
      if (!credentialType || !credentials) return [];
      return credentials.filter(c => c.type === credentialType);
    };
  }, [credentials]);

  if (!isOpen || !selectedNode || !nodeDefinition) return null;

  const properties = nodeDefinition.properties || [];

  return (
    <div className="node-settings-modal-backdrop" onClick={onClose}>
      <div 
        className="node-settings-modal" 
        onClick={(e) => e.stopPropagation()}
      >
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
        <div className="modal-header">
          <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–¥—ã: {nodeDefinition.displayName}</h2>
          <button className="close-btn" onClick={onClose}>‚úï</button>
        </div>

        {/* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
        <div className="node-settings-content">
          
          {/* –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê - INPUT */}
          <div className="settings-column left">
            
            <IOPanel 
              title="Input" 
              data={runData.input || []} 
            />
          </div>

          {/* –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ö–û–õ–û–ù–ö–ê - –ù–ê–°–¢–†–û–ô–ö–ò –ù–û–î–´ */}
          <div className="settings-column center">
            <div className="settings-panel-content">
              {properties.length === 0 ? (
                <div className="empty">–£ —ç—Ç–æ–π –Ω–æ–¥—ã –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫.</div>
              ) : (
                properties.map((prop) => {
                  const value = selectedNode.data[prop.name] ?? "";
                  const credentialType = prop.typeOptions?.credentialType;

                  return (
                    <div key={prop.name} className="form-group">
                      <label>{prop.displayName}</label>
                      
                      {prop.type === "credentials" ? (
                        <div className="credential-selector">
                          <select
                            value={value}
                            onChange={(e) => 
                              handleDataChange(prop.name, e.target.value)
                            }
                            className="credential-select"
                          >
                            <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ credential ‚Äî</option>
                            {getCredentialsByType(credentialType).map(cred => (
                              <option key={cred.id} value={cred.id}>
                                {cred.name}
                              </option>
                            ))}
                          </select>
                          <button
                            className="add-credential-btn"
                            onClick={() => handleOpenCredentialModal(prop.name, credentialType)}
                            title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π credential"
                          >
                            +
                          </button>
                        </div>
                      ) : prop.type === "string" && 
                        prop.typeOptions?.multiline ? (
                        <textarea
                          placeholder={prop.placeholder}
                          value={value}
                          onChange={(e) => 
                            handleDataChange(prop.name, e.target.value)
                          }
                          className="multiline-input"
                          rows={prop.typeOptions?.rows || 4}
                        />
                      ) : prop.type === "number" ? (
                        <input
                          type="number"
                          value={value}
                          min={prop.typeOptions?.min}
                          max={prop.typeOptions?.max}
                          step={prop.typeOptions?.step}
                          onChange={(e) => 
                            handleDataChange(
                              prop.name,
                              Number(e.target.value)
                            )
                          }
                          className="number-input"
                        />
                      ) : prop.type === "options" ? (
                        <select
                          value={value}
                          onChange={(e) => 
                            handleDataChange(prop.name, e.target.value)
                          }
                          className="options-select"
                        >
                          {prop.options.map((opt) => (
                            <option key={opt.value} value={opt.value}>
                              {opt.name}
                            </option>
                          ))}
                        </select>
                      ) : (
                        <input
                          type="text"
                          placeholder={prop.placeholder}
                          value={value}
                          onChange={(e) => 
                            handleDataChange(prop.name, e.target.value)
                          }
                          className="text-input"
                        />
                      )}
                    </div>
                  );
                })
              )}
            </div>
          </div>

          {/* –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê - OUTPUT –° –í–ö–õ–ê–î–ö–ê–ú–ò */}
          <div className="settings-column right">
            <div className="output-tabs">
              {["output", "raw", "error"].map((tab) => (
                <button
                  key={tab}
                  className={activeTab === tab ? "active" : ""}
                  onClick={() => setActiveTab(tab)}
                >
                  {tab.toUpperCase()}
                </button>
              ))}
            </div>
            
            {activeTab === "output" && (
              <IOPanel 
                title="Output" 
                data={runData.output || []} 
              />
            )}
            
            {activeTab === "raw" && (
              <IOPanel 
                title="Raw Execution Data" 
                data={runData} 
              />
            )}
            
            {activeTab === "error" && runData.error && (
              <div className="error-panel">
                <div className="error-title">Error</div>
                <div className="error-content">
                  <pre>{JSON.stringify(runData.error, null, 2)}</pre>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\nodeTypes.jsx:
import UniversalNode from "./UniversalNode";

// 1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç "–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
export const defaultNodeType = UniversalNode;

// 2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º "–∫–∞—Ä—Ç—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π" –¥–ª—è –Ω–æ–¥ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º UI (–ø–æ–∫–∞ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ)
export const customNodeTypes = {

};

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\NotificationModal.jsx:
// frontend/src/components/NotificationModal.jsx
import { useEffect } from "react";
import "./NotificationModal.css";

export default function NotificationModal({
  isOpen,
  onClose,
  type = "info", // "info" | "success" | "warning" | "error"
  title,
  message,
  buttons = [],
  autoClose = false,
  autoCloseDelay = 3000,
  showCloseButton = true
}) {
  useEffect(() => {
    if (isOpen && autoClose) {
      const timer = setTimeout(() => {
        onClose();
      }, autoCloseDelay);
      return () => clearTimeout(timer);
    }
  }, [isOpen, autoClose, autoCloseDelay, onClose]);

  if (!isOpen) return null;

  const iconMap = {
    info: "‚ÑπÔ∏è",
    success: "‚úÖ",
    warning: "‚ö†Ô∏è",
    error: "‚ùå"
  };

  const colorMap = {
    info: "#3b82f6",    // —Å–∏–Ω–∏–π
    success: "#10b981", // –∑–µ–ª–µ–Ω—ã–π
    warning: "#f59e0b", // –∂–µ–ª—Ç—ã–π
    error: "#ef4444"    // –∫—Ä–∞—Å–Ω—ã–π
  };

  return (
    <div className="notification-toast">
      <div 
        className="notification-content"
        style={{ borderLeft: `4px solid ${colorMap[type]}` }}
      >
        <div className="notification-header">
          <div className="notification-icon">
            {iconMap[type]}
          </div>
          <div className="notification-title">
            {title}
          </div>
          {showCloseButton && (
            <button className="notification-close" onClick={onClose}>
              ‚úï
            </button>
          )}
        </div>

        <div className="notification-body">
          {typeof message === "string" ? (
            <p>{message}</p>
          ) : (
            <div className="notification-content">
              {message}
            </div>
          )}
        </div>

        {buttons.length > 0 && (
          <div className="notification-footer">
            {buttons.map((button, index) => (
              <button
                key={index}
                className={`notification-btn ${button.className || ""}`}
                onClick={button.onClick}
                style={button.style}
                autoFocus={button.autoFocus}
              >
                {button.label}
              </button>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\SaveWorkflowModal.jsx:
// frontend/src/components/SaveWorkflowModal.jsx
import { useState, useEffect } from "react";
import "./SaveWorkflowModal.css";

export default function SaveWorkflowModal({
  isOpen,
  onClose,
  onSave,
  defaultName = "",
  isSaving = false // –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä
}) {
  const [name, setName] = useState(defaultName);

  useEffect(() => {
    if (isOpen) {
      setName(defaultName);
    }
  }, [isOpen, defaultName]);

  const handleSave = async () => {
    if (!name.trim() || isSaving) {
      return;
    }
    
    await onSave(name.trim());
    setName("");
  };

  const handleCancel = () => {
    if (!isSaving) {
      setName("");
      onClose();
    }
  };

  if (!isOpen) return null;

  return (
    <div className="save-modal-backdrop" onClick={handleCancel}>
      <div className="save-modal" onClick={(e) => e.stopPropagation()}>
        <h2>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É</h2>
        
        <div className="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã</label>
          <input
            type="text"
            value={name}
            onChange={(e) => setName(e.target.value)}
            placeholder="–ú–æ—è –Ω–æ–≤–∞—è —Å—Ö–µ–º–∞"
            autoFocus
            disabled={isSaving}
            onKeyDown={(e) => {
              if (e.key === 'Enter') handleSave();
              if (e.key === 'Escape') handleCancel();
            }}
          />
          <div className="hint">
            –°—Ö–µ–º–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ø–∞–ø–∫–µ workflows –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
          </div>
        </div>

        <div className="modal-footer">
          <button 
            className="btn cancel" 
            onClick={handleCancel}
            disabled={isSaving}
          >
            –û—Ç–º–µ–Ω–∞
          </button>
          <button 
            className="btn save" 
            onClick={handleSave}
            disabled={isSaving || !name.trim()}
          >
            {isSaving ? "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..." : "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}
          </button>
        </div>
      </div>
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\SettingsPanel.jsx:
import { useEffect, useState, useMemo } from "react";
import { useFlow } from "../hooks/useFlow";
import "./SettingsPanel.css";
import IOPanel from "./IOPanel";
import CredentialModal from "./credentialModal";
import { useCredentials } from "../hooks/useCredentials";

export default function SettingsPanel() {
  const { nodes, selectedNodeId, updateNodeData, availableNodes } = useFlow();

  // –≤—ã–±—Ä–∞–Ω–Ω–∞—è –Ω–æ–¥–∞ –∏ –µ—ë –æ–ø–∏—Å–∞–Ω–∏–µ
  const [selectedNode, setSelectedNode] = useState(null);
  const [nodeDefinition, setNodeDefinition] = useState(null);

  // hook –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å credentials
  const {
    credentials,
    credentialTypes,
    createCredential,
  } = useCredentials();

  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  const [isModalOpen, setModalOpen] = useState(false);
  const [activeTab, setActiveTab] = useState("output");
  // map –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–¥ –ø–æ –∏–º–µ–Ω–∏
  const availableNodesMap = useMemo(() => {
    return new Map(availableNodes.map((def) => [def.name, def]));
  }, [availableNodes]);

  // –æ–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–æ–¥—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ selectedNodeId
  useEffect(() => {
    if (selectedNodeId) {
      const node = nodes.find((n) => n.id === selectedNodeId);
      setSelectedNode(node);

      const def = availableNodesMap.get(node?.type);
      setNodeDefinition(def ?? null);
    } else {
      setSelectedNode(null);
      setNodeDefinition(null);
    }
  }, [selectedNodeId, nodes, availableNodesMap]);

  // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–æ–¥—ã
  const handleDataChange = (propertyName, value) => {
    if (selectedNodeId) {
      updateNodeData(selectedNodeId, { [propertyName]: value });
    }
  };

  // –µ—Å–ª–∏ –Ω–æ–¥–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ - –ù–ï –†–ï–ù–î–ï–†–ò–ú –ü–ê–ù–ï–õ–¨ –í–û–û–ë–©–ï
  if (!selectedNodeId || !selectedNode || !nodeDefinition) {
    return null; // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
  }

  const properties = nodeDefinition.properties || [];
  const runData = selectedNode.data?.runData || {};

  return (
  <>
    <div className="node-inspector-wrapper">

      {/* –°–õ–ï–í–ê ‚Äî INPUT (–∫–∞–∫ –≤ n8n) */}
      <div className="node-panel left">
        <IOPanel
          title="Input"
          data={runData.input}
        />
      </div>

      {/* –¶–ï–ù–¢–† ‚Äî —Ç–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—á—Ç–æ —É–∂–µ –±—ã–ª–æ) */}
      <div className="node-panel center settings-panel">

        <div className="panel-header">
          {nodeDefinition.displayName}
          <div
            style={{
              fontSize: "11px",
              color: "#9ca3af",
              marginTop: "4px",
              userSelect: "text",
              fontFamily: "monospace"
            }}
          >
            ID: {selectedNode.id}
          </div>
        </div>

        <div className="panel-content">
          {properties.length === 0 ? (
            <div className="empty">–£ —ç—Ç–æ–π –Ω–æ–¥—ã –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫.</div>
          ) : (
            properties.map((prop) => {
              const value = selectedNode.data[prop.name] ?? "";

              return (
                <div key={prop.name} className="form-group">
                  <label>{prop.displayName}</label>

                  {/** ‚Üì‚Üì‚Üì –ù–ò–ß–ï–ì–û –í –¢–í–û–ï–ô –õ–û–ì–ò–ö–ï –ù–ï –õ–û–ú–ê–ï–ú ‚Üì‚Üì‚Üì */}

                  {prop.type === "credentials" ? (
                    <div style={{ display: "flex", gap: "6px" }}>
                      <select
                        value={value}
                        onChange={(e) =>
                          handleDataChange(prop.name, e.target.value)
                        }
                        style={{
                          flex: 1,
                          padding: "8px",
                          borderRadius: "6px",
                          background: "#374151",
                          color: "white",
                          border: "1px solid #4b5563",
                        }}
                      >
                        <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ credential ‚Äî</option>
                        {credentials && Array.isArray(credentials) && credentials
                          .filter((c) => {
                            const requiredType =
                              prop.typeOptions?.credentialType;
                            return requiredType
                              ? c.type === requiredType
                              : true;
                          })
                          .map((c) => (
                            <option key={c.id} value={c.id}>
                              {c.name}
                            </option>
                          ))}
                      </select>

                      <button
                        onClick={() => setModalOpen(true)}
                        style={{
                          width: "34px",
                          height: "34px",
                          borderRadius: "6px",
                          background: "#4f46e5",
                          color: "white",
                          fontWeight: "bold",
                          border: "none",
                          display: "flex",
                          alignItems: "center",
                          justifyContent: "center",
                          padding: 0,
                          cursor: "pointer",
                        }}
                      >
                        +
                      </button>
                    </div>
                  ) : prop.type === "string" &&
                    prop.typeOptions?.multiline ? (
                    <textarea
                      placeholder={prop.placeholder}
                      value={value}
                      onChange={(e) =>
                        handleDataChange(prop.name, e.target.value)
                      }
                      style={{
                        minHeight: prop.typeOptions.rows
                          ? `${prop.typeOptions.rows * 1.5}em`
                          : "100px",
                        width: "100%",
                        resize: "vertical",
                        padding: "8px",
                        borderRadius: "6px",
                        background: "#374151",
                        color: "white",
                        border: "1px solid #4b5563",
                        boxSizing: "border-box",
                      }}
                    />
                  ) : prop.type === "number" ? (
                    <input
                      type="number"
                      value={value}
                      min={prop.typeOptions?.min}
                      max={prop.typeOptions?.max}
                      step={prop.typeOptions?.step}
                      onChange={(e) =>
                        handleDataChange(
                          prop.name,
                          Number(e.target.value)
                        )
                      }
                      style={{ width: "100%" }}
                    />
                  ) : prop.type === "options" ? (
                    <select
                      value={value}
                      onChange={(e) =>
                        handleDataChange(prop.name, e.target.value)
                      }
                      style={{
                        width: "100%",
                        padding: "8px",
                        borderRadius: "6px",
                        background: "#374151",
                        color: "white",
                        border: "1px solid #4b5563",
                      }}
                    >
                      {prop.options.map((opt) => (
                        <option
                          key={opt.value}
                          value={opt.value}
                        >
                          {opt.name}
                        </option>
                      ))}
                    </select>
                  ) : (
                    <input
                      type="text"
                      placeholder={prop.placeholder}
                      value={value}
                      onChange={(e) =>
                        handleDataChange(
                          prop.name,
                          e.target.value
                        )
                      }
                      style={{ width: "100%" }}
                    />
                  )}
                </div>
              );
            })
          )}
        </div>

      </div>

      {/* –°–ü–†–ê–í–ê ‚Äî OUTPUT –∫–∞–∫ –≤ n8n */}
      <div className="node-panel right">

        <div className="tabs">
  {["input", "output", "raw", "error"].map(tab => (
    <button
      key={tab}
      className={activeTab === tab ? "active" : ""}
      onClick={() => setActiveTab(tab)}
    >
      {tab.toUpperCase()}
    </button>
  ))}
          </div>
          
          {activeTab === "input" && (
            <IOPanel
              title="Input"
              data={runData.input}
            />
          )}
          
          {activeTab === "output" && (
  <IOPanel
    title="Output"
    data={runData.output}
  />
          )}
          
          {activeTab === "raw" && (
            <IOPanel
              title="Raw Execution Data"
              data={runData}
            />
          )}
          
          {activeTab === "error" && runData.error && (
            <div className="io-panel error">
              <div className="io-title">Error</div>
    <div className="io-error-content">
      <pre>{JSON.stringify(runData.error, null, 2)}</pre>
              </div>
            </div>
)}

      </div>

    </div>

    {/* –ú–æ–¥–∞–ª–∫–∞ credentials ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */}
    <CredentialModal
      isOpen={isModalOpen}
      onClose={() => setModalOpen(false)}
      credentialTypes={credentialTypes}
      onCreate={createCredential}
    />

  </>
);

}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\Sidebar.jsx:
import { useState, useMemo } from "react";
import { useFlow } from "../hooks/useFlow";
import { useNotification } from "../hooks/useNotification";
import SaveWorkflowModal from "./SaveWorkflowModal";
import LoadWorkflowModal from "./LoadWorkflowModal";
import ConfirmDialog from "./ConfirmDialog";
import "./Sidebar.css";
import { useModal } from "./../contexts/ModalContext";
import { useCredentials } from "../contexts/CredentialsContext"; // –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç

export default function Sidebar() {
  const { 
    addNode, 
    runFlow, 
    saveFlow, 
    loadFlow, 
    newFlow, 
    availableNodes,
    nodes,
    edges
  } = useFlow();
  
  const { showSuccess, showError, showInfo } = useNotification();
   const { createCredential, loadCredentials } = useCredentials();
  const [isSaveModalOpen, setSaveModalOpen] = useState(false);
  const [isLoadModalOpen, setLoadModalOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");
  const [isSaving, setIsSaving] = useState(false);
  
  const { openModal, closeModal } = useModal();

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ credentials
  const handleOpenCredentialManager = () => {
  openModal("credentialManager", {
    title: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Credentials",
    onCredentialCreated: (newCredential) => {
      console.log("–ù–æ–≤—ã–π credential —Å–æ–∑–¥–∞–Ω:", newCredential);
      // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å credentials –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
      if (loadCredentials) {
        loadCredentials();
      }
    },
    onCredentialDeleted: (deletedId) => {
      console.log("Credential —É–¥–∞–ª–µ–Ω:", deletedId);
      // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å credentials –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
      if (loadCredentials) {
        loadCredentials();
      }
    }
  });
};

  const handleSave = async (name) => {
    if (isSaving) return;
    
    setIsSaving(true);
    setSaveModalOpen(false);
    
    try {
      const id = await saveFlow(name);
      showSuccess(
        "–°—Ö–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞",
        `–°—Ö–µ–º–∞ "${name}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å ID: ${id}`,
        { autoClose: true, autoCloseDelay: 4000 }
      );
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã:", error);
      showError(
        "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",
        error.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É",
        {
          buttons: [
            {
              label: "–ó–∞–∫—Ä—ã—Ç—å",
              onClick: () => {},
              className: ""
            }
          ]
        }
      );
      setSaveModalOpen(true);
    } finally {
      setIsSaving(false);
    }
  };

  const handleLoad = async (id) => {
    try {
      const flow = await loadFlow(id);
      showSuccess(
        "–°—Ö–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞",
        `–°—Ö–µ–º–∞ "${flow.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞`,
        { autoClose: true, autoCloseDelay: 3000 }
      );
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ö–µ–º—ã:", error);
      showError(
        "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",
        error.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É",
        {
          buttons: [
            {
              label: "–ó–∞–∫—Ä—ã—Ç—å",
              onClick: () => {},
              className: ""
            }
          ]
        }
      );
    }
  };

  const handleNewFlow = () => {
  // –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º newFlow - –æ–Ω–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  newFlow();
};

  

  const handleRunFlow = async () => {
    try {
      await runFlow();
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã:", error);
    }
  };

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–¥ –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
  const filteredNodes = useMemo(() => {
    if (!searchQuery.trim()) return availableNodes;

    const query = searchQuery.toLowerCase().trim();
    return availableNodes.filter(node => {
      const displayName = node.displayName || "";
      const name = node.name || "";
      const description = node.description || "";

      return (
        displayName.toLowerCase().includes(query) ||
        name.toLowerCase().includes(query) ||
        description.toLowerCase().includes(query)
      );
    });
  }, [availableNodes, searchQuery]);
  
  const highlightText = (text, query) => {
    if (!query.trim() || !text) return text;
    
    const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
    const parts = text.split(regex);
    
    return parts.map((part, index) => {
      if (part.toLowerCase() === query.toLowerCase()) {
        return (
          <span 
            key={index}
            style={{
              backgroundColor: 'rgba(251, 191, 36, 0.3)',
              color: '#fbbf24',
              fontWeight: 600,
              display: 'inline',
              padding: '0',
              margin: '0'
            }}
          >
            {part}
          </span>
        );
      }
      return <span key={index}>{part}</span>;
    });
  };

  const clearSearch = () => {
    setSearchQuery("");
  };

  return (
    <>
      <div className="sidebar">
        {/* --- –°–ï–ö–¶–ò–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø --- */}
        <div className="sidebar-header">
          <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        </div>
        <div className="sidebar-controls">
          <button onClick={handleNewFlow} title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ö–µ–º—É">
            üÜï –ù–æ–≤–∞—è —Å—Ö–µ–º–∞
          </button>
          <button 
            onClick={() => setSaveModalOpen(true)} 
            title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É"
            disabled={isSaving}
          >
            {isSaving ? "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..." : "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É"}
          </button>
          <button onClick={() => setLoadModalOpen(true)} title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É">
            üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É
          </button>
          <button onClick={handleRunFlow} className="run-button" title="–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ">
            ‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
          </button>
          {/* –ö–ù–û–ü–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø CREDENTIALS */}
          <button 
            onClick={handleOpenCredentialManager} 
            title="–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
            className="credentials-button"
          >
          –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          </button>
        </div>

        {/* --- –ü–û–ò–°–ö –ù–û–î --- */}
        <div className="search-section">
          <h3>–ü–æ–∏—Å–∫ –Ω–æ–¥</h3>
          <div className="search-container">
            <div className="search-input-wrapper">
              <input
                type="text"
                className="search-input"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–¥—ã"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter' && filteredNodes.length > 0) {
                    addNode(filteredNodes[0].name, filteredNodes[0]);
                    clearSearch();
                  }
                  if (e.key === 'Escape') clearSearch();
                }}
                autoComplete="off"
              />
              <button 
                className="clear-search-btn"
                onClick={clearSearch}
                title={searchQuery ? "–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫" : "–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ"}
                disabled={!searchQuery}
              >
                ‚úï
              </button>
            </div>
          </div>
          <div className="search-stats">
            {searchQuery ? (
              <span>
                –ù–∞–π–¥–µ–Ω–æ: {filteredNodes.length} –∏–∑ {availableNodes.length}
              </span>
            ) : (
              <span>
                –í—Å–µ–≥–æ –Ω–æ–¥: {availableNodes.length}
              </span>
            )}
          </div>
        </div>

        {/* --- –°–ü–ò–°–û–ö –ù–û–î --- */}
        <div className="sidebar-header">
          <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–æ–¥—ã</h3>
        </div>
        <div className="sidebar-nodes-list">
          {filteredNodes.length === 0 ? (
            <div className="no-nodes-found">
              {searchQuery ? (
                <>
                  <div className="no-nodes-icon">üîç</div>
                  <div className="no-nodes-text">–ù–æ–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                  <div className="no-nodes-hint">
                    –ü–æ –∑–∞–ø—Ä–æ—Å—É "{searchQuery}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                  </div>
                  <button 
                    className="clear-search-link"
                    onClick={clearSearch}
                  >
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –Ω–æ–¥—ã
                  </button>
                </>
              ) : (
                <>
                  <div className="no-nodes-icon">üß©</div>
                  <div className="no-nodes-text">–ù–æ–¥—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</div>
                  <div className="no-nodes-hint">
                    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
                  </div>
                </>
              )}
            </div>
          ) : (
            filteredNodes.map(nodeDef => (
              <button 
                key={nodeDef.name} 
                onClick={() => {
                  addNode(nodeDef.name, nodeDef);
                  clearSearch();
                }}
                className="node-button"
                title={`–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É "${nodeDef.displayName}"`}
              >
                <span className="node-button-text">
                  {highlightText(nodeDef.displayName, searchQuery)}
                </span>
              </button>
            ))
          )}
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */}
      <SaveWorkflowModal
        isOpen={isSaveModalOpen}
        onClose={() => {
          if (!isSaving) {
            setSaveModalOpen(false);
          }
        }}
        onSave={handleSave}
        defaultName="–ú–æ—è —Å—Ö–µ–º–∞"
        isSaving={isSaving}
      />
      
      <LoadWorkflowModal
        isOpen={isLoadModalOpen}
        onClose={() => setLoadModalOpen(false)}
        onLoad={handleLoad}
      />
      
    </>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\components\UniversalNode.jsx:
// frontend/src/components/UniversalNode.jsx
import { Handle, Position } from "reactflow";
import "./customNodes.css";
import { useFlow } from "../hooks/useFlow";

export default function UniversalNode({ id, type, data, isConnectable, selected }) {
  const { availableNodes } = useFlow();
  const nodeDefinition = availableNodes.find(n => n.name === type);

  const inputs = nodeDefinition?.inputs ?? [];
  const outputs = nodeDefinition?.outputs ?? [];

  const nodeClasses = `custom-node ${type} ${selected ? 'selected' : ''}`;
  const minHeight = 40 + Math.max(inputs.length, outputs.length) * 25;

  return (
    <div className={nodeClasses} style={{ minHeight: `${minHeight}px` }}>
      <div className="node-title">{data.label || type}</div>

      <div className="node-ports-container">
        
        {/* –í–•–û–î–´ */}
        <div className="port-list input-list">
          {inputs.map((port) => (
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º port.id –∫–∞–∫ –∫–ª—é—á –∏ –∫–∞–∫ id –¥–ª—è Handle
            <div key={port.id} className="node-port">
              <Handle
                type="target"
                id={port.id} //–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π ID
                position={Position.Left}
                className="node-handle target"
                isConnectable={isConnectable}
              />
              <span className="port-label">{port.displayName}</span>
            </div>
          ))}
        </div>

        {/* –í–´–•–û–î–´ */}
        <div className="port-list output-list">
          {outputs.map((port) => (
            <div key={port.id} className="node-port">
              <span className="port-label">{port.displayName}</span>
              <Handle
                type="source"
                id={port.id} //–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π ID
                position={Position.Right}
                className="node-handle source"
                isConnectable={isConnectable}
              />
            </div>
          ))}
        </div>
      </div>
      
      {/* –ü—Ä–µ–≤—å—é */}
      {data.output && (
        <div className="node-output-preview">
          <pre>{data.output}</pre>
        </div>
      )}
    </div>
  );
}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\contexts\CredentialsContext.jsx:
// frontend/src/contexts/CredentialsContext.jsx - –¥–æ–±–∞–≤—å—Ç–µ deleteCredential
import { createContext, useContext, useState, useEffect, useCallback } from "react";
import axios from "axios";

const CredentialsContext = createContext();

export const CredentialsProvider = ({ children }) => {
  const [credentials, setCredentials] = useState([]);
  const [credentialTypes, setCredentialTypes] = useState([]);
  const [loading, setLoading] = useState(true);

  // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ credential types
  const loadCredentialTypes = useCallback(async () => {
    try {
      const typesResponse = await axios.get("http://localhost:3001/api/credential-types");
      setCredentialTypes(typesResponse.data);
    } catch (error) {
      console.error("Failed to load credential types:", error);
    }
  }, []);

  // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ credentials
  const loadCredentials = useCallback(async () => {
    try {
      const credsResponse = await axios.get("http://localhost:3001/api/credentials");
      setCredentials(credsResponse.data);
    } catch (error) {
      console.error("Failed to load credentials:", error);
    }
  }, []);

  // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è credential
  const createCredential = useCallback(async (name, type, data) => {
    try {
      const response = await axios.post("http://localhost:3001/api/credentials", {
        name,
        type,
        data,
      });
      
      const newCredential = response.data;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
      await loadCredentials();
      
      return newCredential;
    } catch (error) {
      console.error("Failed to create credential:", error);
      throw error;
    }
  }, [loadCredentials]);

  // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è credential
  const deleteCredential = useCallback(async (id) => {
    try {
      await axios.delete(`http://localhost:3001/api/credentials/${id}`);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
      await loadCredentials();
      
      return true;
    } catch (error) {
      console.error("Failed to delete credential:", error);
      throw error;
    }
  }, [loadCredentials]);

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const initialize = async () => {
      try {
        await Promise.all([
          loadCredentialTypes(),
          loadCredentials()
        ]);
      } catch (error) {
        console.error("Failed to initialize credentials:", error);
      } finally {
        setLoading(false);
      }
    };
    
    initialize();
  }, [loadCredentialTypes, loadCredentials]);

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è credential –ø–æ ID
  const getCredentialById = useCallback((id) => {
    return credentials.find(c => c.id === id);
  }, [credentials]);

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è credentials –ø–æ —Ç–∏–ø—É
  const getCredentialsByType = useCallback((type) => {
    return credentials.filter(c => c.type === type);
  }, [credentials]);

  return (
    <CredentialsContext.Provider
      value={{
        credentials,
        credentialTypes,
        loading,
        createCredential,
        deleteCredential, // –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£
        loadCredentials,
        loadCredentialTypes,
        getCredentialById,
        getCredentialsByType,
      }}
    >
      {children}
    </CredentialsContext.Provider>
  );
};

export const useCredentials = () => {
  const context = useContext(CredentialsContext);
  if (!context) {
    throw new Error("useCredentials must be used within CredentialsProvider");
  }
  return context;
};

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\contexts\ModalContext.jsx:
import { createContext, useContext, useState } from "react";

const ModalContext = createContext();

export const ModalProvider = ({ children }) => {
  const [modals, setModals] = useState({
    credential: false,
    credentialManager: false,
    nodeSettings: false,
    loadWorkflow: false,
    saveWorkflow: false,
    notification: false,
    confirm: false,
  });
  
  const [modalProps, setModalProps] = useState({});
  
  const openModal = (name, props = {}) => {
    console.log(`üìÇ Opening modal: ${name}`, props);
    setModals(prev => ({ ...prev, [name]: true }));
    setModalProps(prev => ({ ...prev, [name]: props }));
  };
  
  const closeModal = (name) => {
    console.log(`üìÇ Closing modal: ${name}`);
    setModals(prev => ({ ...prev, [name]: false }));
    setModalProps(prev => ({ ...prev, [name]: null }));
  };
  
  const closeAllModals = () => {
    console.log("üìÇ Closing all modals");
    setModals({
      credential: false,
      credentialManager: false,
      nodeSettings: false,
      loadWorkflow: false,
      saveWorkflow: false,
      notification: false,
      confirm: false,
    });
    setModalProps({});
  };
  
  const isAnyModalOpen = () => {
    return Object.values(modals).some(isOpen => isOpen);
  };
  
  return (
    <ModalContext.Provider value={{ 
      modals, 
      modalProps, 
      openModal, 
      closeModal,
      closeAllModals,
      isAnyModalOpen
    }}>
      {children}
    </ModalContext.Provider>
  );
};

export const useModal = () => {
  const context = useContext(ModalContext);
  if (!context) {
    throw new Error("useModal must be used within ModalProvider");
  }
  return context;
};

export { ModalContext };

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\hooks\useFlow.jsx:
import { createContext, useContext, useState, useEffect } from "react";
import { useFlowState } from "./useFlowState";
import { useNotification } from "../hooks/useNotification"; 
// 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏"
import { defaultNodeType, customNodeTypes } from "../components/nodeTypes";

const FlowContext = createContext();

export const FlowProvider = ({ children }) => {
  const { showError, showSuccess, showConfirm } = useNotification();
  
  // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ useFlowState
  const flowState = useFlowState(showError, showSuccess, showConfirm);
  // 2. –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  const [availableNodes, setAvailableNodes] = useState([]);
  const [dynamicNodeTypes, setDynamicNodeTypes] = useState(null); // null = –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ

  // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–¥ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  useEffect(() => {
    fetch("http://localhost:3001/api/nodes")
      .then(res => res.json())
      .then(nodeDefinitions => {
        
        const newTypes = {};
        
        for (const nodeDef of nodeDefinitions) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç—Ç–∞ –Ω–æ–¥–∞ –≤ "–∫–∞—Ä—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π"
          if (customNodeTypes[nodeDef.name]) {
            newTypes[nodeDef.name] = customNodeTypes[nodeDef.name];
          } else {
            // –ï—Å–ª–∏ –Ω–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π" –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
            newTypes[nodeDef.name] = defaultNodeType;
          }
        }
        
        console.log("üß© –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –Ω–æ–¥:", newTypes);
        setDynamicNodeTypes(newTypes); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
        setAvailableNodes(nodeDefinitions); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è Sidebar
      })
      .catch(err => {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –Ω–æ–¥:", err);
        setDynamicNodeTypes({}); // –°—Ç–∞–≤–∏–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ª–æ–º–∞–ª–æ—Å—å
      });
  }, []); 

  // 4. –ù–µ —Ä–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–∫–∞ –Ω–æ–¥—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  if (!dynamicNodeTypes) {
    return <div>Loading workflow nodes...</div>; 
  }

  // 5. –ü–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ Context
  return (
    <FlowContext.Provider value={{ 
      ...flowState, 
      nodeTypes: dynamicNodeTypes,
      availableNodes: availableNodes,
      isSettingsModalOpen: flowState.isSettingsModalOpen,
      settingsModalNodeId: flowState.settingsModalNodeId,
      closeSettingsModal: flowState.closeSettingsModal,
    }}>
      {children}
    </FlowContext.Provider>
  );
};

export const useFlow = () => {
  const context = useContext(FlowContext);
  if (!context) {
    throw new Error("useFlow –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ FlowProvider");
  }
  return context;
};

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\hooks\useFlowState.jsx:
import { useState, useCallback } from "react";
import { applyNodeChanges, applyEdgeChanges, addEdge, useReactFlow } from "reactflow";
import axios from "axios";

export const useFlowState = (showError, showSuccess, showConfirm) => {
  const [nodes, setNodes] = useState([]);
  const [edges, setEdges] = useState([]);
  const [result, setResult] = useState(""); 

  const [selectedNodeId, setSelectedNodeId] = useState(null);

  // –ü–æ–ª—É—á–∞–µ–º instance reactflow –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è viewport'–æ–º
  const { setViewport } = useReactFlow();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è React Flow
  const onNodesChange = useCallback(
    (changes) => {

      const selectChange = changes.find(change => change.type === 'select');
      if (selectChange) {
        console.log('‚ö°Ô∏è Select Change:', selectChange);
        setSelectedNodeId(selectChange.selected ? selectChange.id : null);
      }

      setNodes((nds) => applyNodeChanges(changes, nds));
    },
    [setNodes, setSelectedNodeId]
  );


  const onEdgesChange = useCallback(
    (changes) => setEdges((eds) => applyEdgeChanges(changes, eds)),
    [setEdges]
  );


  const onConnect = useCallback(
    (connection) => {
        console.log("üîó New connection:", connection);
        setEdges((eds) => addEdge(connection, eds));
    },
    [setEdges]
  );
  

  // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–¥—ã
  const addNode = useCallback((type, nodeDef) => {
    // –ü–æ–ª—É—á–∞–µ–º 'properties' –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–¥—ã
    const properties = nodeDef.properties || [];
    const defaultData = {
      label: nodeDef.displayName || type,
    };
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º 'data' –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ 'properties'
    properties.forEach(prop => {
      defaultData[prop.name] = prop.default;
    });

    const newNode = {
      id: `${type}-${Date.now()}`,
      type,
      position: { x: Math.random() * 400 + 100, y: Math.random() * 400 + 100 },
      data: defaultData, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ defaultData
    };
    setNodes((nds) => [...nds, newNode]);
  }, [setNodes]);


  // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–æ–¥—ã
  const updateNodeData = useCallback((nodeId, newData) => {
    console.log("Updating node:", nodeId, newData);
    
    setNodes((nds) =>
      nds.map((node) =>
        node.id === nodeId
          ? { ...node, data: { ...node.data, ...newData } }
          : node
      )
    );
  }, [setNodes]);
const [isSettingsModalOpen, setIsSettingsModalOpen] = useState(false);
const [settingsModalNodeId, setSettingsModalNodeId] = useState(null);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞
const handleNodeDoubleClick = useCallback((event, node) => {
  setSettingsModalNodeId(node.id);
  setIsSettingsModalOpen(true);
}, []);

const closeSettingsModal = useCallback(() => {
  setIsSettingsModalOpen(false);
  setSettingsModalNodeId(null);
}, []);
const [isRunning, setIsRunning] = useState(false);
  // –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞
// const runFlow = useCallback(async () => {
//   setIsRunning(true);

//   // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –ø—Ä–æ—à–ª—ã–π result.runData —É output'–æ–≤ (–Ω–µ –º—É—Ç–∏—Ä—É–µ–º internals!)
//   setNodes(nds =>
//     nds.map(n =>
//       n.type === 'output'
//         ? { ...n, data: { ...n.data, runData: undefined } }
//         : n
//     )
//   );

//   try {
//     // –ë–µ—Ä—ë–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ nodes/edges –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤–º–µ—Å—Ç–æ –∑–∞–º—ã–∫–∞–Ω–∏—è)
//     let currentNodes, currentEdges;
//     // –ü–æ–ª—É—á–∞–µ–º snapshot –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é (–Ω–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ; –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–º—ã–∫–∞–Ω–∏–µ nodes/edges)
//     // –ï—Å–ª–∏ –±–µ—Å–ø–æ–∫–æ–∏—Ç stale closure ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å nodes/edges —è–≤–Ω–æ –≤ runFlow –≤—ã–∑–æ–≤–µ.
//     currentNodes = nodes;
//     currentEdges = edges;

//     console.log("üß© –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –Ω–æ–¥—ã:", JSON.stringify(currentNodes, null, 2));
//     console.log("üîó –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:", JSON.stringify(currentEdges, null, 2));

//     const response = await axios.post("http://localhost:3001/api/workflow/run", {
//       nodes: currentNodes,
//       edges: currentEdges,
//     });

//     const results = response.data;

//     // –°–æ–±–∏—Ä–∞–µ–º ID –Ω–æ–¥, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–Ω–æ–≤–∏–ª–∏
//     const updatedNodeIds = new Set();
//     console.log("üì¶ runFlow results:", results);
//     console.log("üì¶ result ids:", results.map(r => r.nodeId));
//     console.log("üì¶ current nodes:", nodes.map(n => n.id));
//     if (Array.isArray(results)) {
//       results.forEach(res => {
//         if (res?.nodeId && res?.data) {
//           // –ö–ª–∞–¥—ë–º runData –≤ .data.runData
//           updateNodeData(res.nodeId, {
//             runData: res.data.runData ?? res.data.output ?? res.data
//           });
//           updatedNodeIds.add(res.nodeId);
//         }
//       });
//     }

//     // –î–ª—è output-–Ω–æ–¥, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ ‚Äî –æ—Å—Ç–∞–≤–∏–º runData undefined (—á—Ç–æ–±—ã UI –æ—Ç–æ–±—Ä–∞–∂–∞–ª "–ù–µ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—å")
//     // –í–ê–ñ–ù–û: –∑–¥–µ—Å—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º n –≤–æ –≤—Å–µ—Ö –≤–µ—Ç–∫–∞—Ö
//     setNodes(nds =>
//       nds.map(n => {
//         if (n.type === 'output' && !updatedNodeIds.has(n.id)) {
//           return {
//             ...n,
//             data: {
//               ...n.data,
//               runData: undefined
//             }
//           };
//         }
//         return n;
//       })
//     );

//     console.log("‚úÖ –°—Ö–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞");
//   } catch (err) {
//     console.error("‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã:", err);

//     let errorMessage = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã";
//     if (err.response?.data?.details) {
//       errorMessage += `: ${err.response.data.details}`;
//     } else if (err.message) {
//       errorMessage += `: ${err.message}`;
//     }

//     if (showError) {
//       showError("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", errorMessage);
//     } else {
//       // fallback
//       console.error(errorMessage);
//     }

//     // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ ‚Äî –ø–æ–º–µ—Ç–∏–º output –Ω–æ–¥—ã –æ—à–∏–±–∫–æ–π –≤ runData
//     setNodes(nds =>
//       nds.map(n =>
//         n.type === 'output'
//           ? { ...n, data: { ...n.data, runData: { error: errorMessage } } }
//           : n
//       )
//     );
//   }

//   setIsRunning(false);
// }, [nodes, edges, updateNodeData, showError]);

const runFlow = useCallback(async () => {
  setIsRunning(true);

  try {
    const response = await axios.post("http://localhost:3001/api/workflow/run", {
      nodes,
      edges,
    });

    const results = response.data;
    
    // –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–ª–∞–¥–∫—É
    console.log("üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:", results);
    
    if (results.outputPreview) {
      results.outputPreview.forEach(res => {
        console.log(`üìä –î–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–¥—ã ${res.nodeId}:`, res.data.runData);
        updateNodeData(res.nodeId, {
          runData: res.data.runData
        });
      });
    }

    console.log("‚úÖ –°—Ö–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞");
  } catch (err) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã:", err);
  }

  setIsRunning(false);
}, [nodes, edges, updateNodeData]);


const saveFlow = useCallback((name) => {
  return new Promise(async (resolve, reject) => {
    // –û—á–∏—â–∞–µ–º runtime-–¥–∞–Ω–Ω—ã–µ
    const nodesToSave = nodes.map(n => ({
      ...n,
      data: { ...n.data, output: "" }
    }));

    try {
      const response = await axios.post("http://localhost:3001/api/workflow/save", {
        name: name,
        nodes: nodesToSave,
        edges,
      });
      resolve(response.data.id);
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã:", err);
      
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º showError –≤–º–µ—Å—Ç–æ –Ω–µ—è–≤–Ω–æ–π –æ—à–∏–±–∫–∏
      if (showError) {
        showError("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", err.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É");
      }
      
      reject(err);
    }
  });
}, [nodes, edges, showError]);


const loadFlow = useCallback((id) => {
  return new Promise(async (resolve, reject) => {
    try {
      const response = await axios.get(`http://localhost:3001/api/workflow/load/${id}`);
      const flow = response.data;

      if (flow.nodes && flow.edges) {
        setNodes(flow.nodes);
        setEdges(flow.edges);
        setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 800 });
        resolve(flow);
      } else {
        const error = new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ö–µ–º—ã");
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º showError –≤–º–µ—Å—Ç–æ –Ω–µ—è–≤–Ω–æ–π –æ—à–∏–±–∫–∏
        if (showError) {
          showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏", error.message);
        }
        
        reject(error);
      }
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ö–µ–º—ã:", err);
      
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º showError –≤–º–µ—Å—Ç–æ –Ω–µ—è–≤–Ω–æ–π –æ—à–∏–±–∫–∏
      if (showError) {
        showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏", err.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É");
      }
      
      reject(err);
    }
  });
}, [setNodes, setEdges, setViewport, showError]);


const newFlow = useCallback(() => {
  if (nodes.length > 0 || edges.length > 0) {
    // –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º showConfirm
    showConfirm({
      title: "–ù–æ–≤–∞—è —Å—Ö–µ–º–∞",
      message: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ö–µ–º—É? –¢–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.",
      onConfirm: () => {
        setNodes([]);
        setEdges([]);
        setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 800 });
        setSelectedNodeId(null);
      },
      onCancel: () => {},
      confirmText: "–°–æ–∑–¥–∞—Ç—å",
      cancelText: "–û—Ç–º–µ–Ω–∞"
    });
  } else {
    setNodes([]);
    setEdges([]);
    setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 800 });
    setSelectedNodeId(null);
  }
}, [nodes.length, edges.length, setNodes, setEdges, setViewport, setSelectedNodeId, showConfirm]);

  return {
    nodes,
    edges,
    onNodesChange,
    selectedNodeId,
    onEdgesChange,
    onConnect,
    addNode,
    updateNodeData,
    runFlow,
    saveFlow, 
    loadFlow, 
    newFlow,
    result,
    isSettingsModalOpen,
    settingsModalNodeId,
    handleNodeDoubleClick,
    closeSettingsModal,
  };
};

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ C:\Users\HAIER\Desktop\LLM\test\frontend\src\hooks\useNotification.jsx:
// frontend/src/hooks/useNotification.jsx
import { createContext, useContext, useState, useCallback } from "react";
import NotificationModal from "../components/NotificationModal";

const NotificationContext = createContext();

export const NotificationProvider = ({ children }) => {
  const [notifications, setNotifications] = useState([]);

  const showNotification = useCallback(({
    type = "info",
    title,
    message,
    buttons = [],
    autoClose = false,
    autoCloseDelay = 3000,
    onClose = null
  }) => {
    const id = Date.now().toString();
    
    setNotifications(prev => [...prev, {
      id,
      isOpen: true,
      type,
      title,
      message,
      buttons,
      autoClose,
      autoCloseDelay,
      onClose: onClose || (() => removeNotification(id))
    }]);

    if (autoClose) {
      setTimeout(() => {
        removeNotification(id);
      }, autoCloseDelay);
    }
  }, []);

  const removeNotification = useCallback((id) => {
    setNotifications(prev => prev.filter(n => n.id !== id));
  }, []);

  // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—É—é —Ñ—É–Ω–∫—Ü–∏—é hideNotification, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º removeNotification

  // –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const showSuccess = useCallback((title, message, options = {}) => {
    showNotification({
      type: "success",
      title,
      message,
      autoClose: true,
      autoCloseDelay: 3000,
      ...options
    });
  }, [showNotification]);

  const showError = useCallback((title, message, options = {}) => {
    showNotification({
      type: "error",
      title,
      message,
      ...options
    });
  }, [showNotification]);

  const showInfo = useCallback((title, message, options = {}) => {
    showNotification({
      type: "info",
      title,
      message,
      ...options
    });
  }, [showNotification]);

  const showWarning = useCallback((title, message, options = {}) => {
    showNotification({
      type: "warning",
      title,
      message,
      ...options
    });
  }, [showNotification]);

  const showConfirm = useCallback(({
  title,
  message,
  onConfirm,
  onCancel,
  confirmText = "–î–∞",
  cancelText = "–ù–µ—Ç"
}) => {
  // –≠—Ç–æ –¥–ª—è –Ω–µ-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const notificationId = Date.now().toString();
  
  showNotification({
    type: "warning",
    title,
    message,
    buttons: [
      {
        label: cancelText,
        onClick: () => {
          removeNotification(notificationId);
          if (onCancel) onCancel();
        },
        className: ""
      },
      {
        label: confirmText,
        onClick: () => {
          removeNotification(notificationId);
          if (onConfirm) onConfirm();
        },
        className: "danger"
      }
    ],
    showCloseButton: false,
    onClose: () => removeNotification(notificationId)
  });
}, [showNotification, removeNotification]);

  return (
    <NotificationContext.Provider value={{
      showNotification,
      hideNotification: removeNotification, // –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      showSuccess,
      showError,
      showInfo,
      showWarning,
      showConfirm
    }}>
      {children}
      {/* –†–µ–Ω–¥–µ—Ä–∏–º –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */}
      {notifications.map(notification => (
        <NotificationModal
          key={notification.id}
          isOpen={notification.isOpen}
          onClose={() => {
            if (notification.onClose) {
              notification.onClose();
            } else {
              removeNotification(notification.id);
            }
          }}
          type={notification.type}
          title={notification.title}
          message={notification.message}
          buttons={notification.buttons}
          autoClose={notification.autoClose}
          autoCloseDelay={notification.autoCloseDelay}
          showCloseButton={notification.showCloseButton !== false}
        />
      ))}
    </NotificationContext.Provider>
  );
};

export const useNotification = () => {
  const context = useContext(NotificationContext);
  if (!context) {
    throw new Error("useNotification must be used within NotificationProvider");
  }
  return context;
};

–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ D:\structurizer\structurizer\storage\outputs\frontend_20260103_144943.txt
